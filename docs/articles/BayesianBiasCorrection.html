<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian adaptive bias correction using profile likelihoods • EvidenceSynthesis</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian adaptive bias correction using profile likelihoods">
<meta property="og:description" content="EvidenceSynthesis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EvidenceSynthesis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BayesianBiasCorrection.html">Bayesian adaptive bias correction using profile likelihoods</a>
    </li>
    <li>
      <a href="../articles/NonNormalEffectSynthesis.html">Effect estimate synthesis using non-normal likelihood approximations</a>
    </li>
    <li>
      <a href="../articles/VideoVignette.html">Code used in the video vignette</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://youtu.be/dho7E97vpgQ" class="external-link">Video vignette</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/EvidenceSynthesis/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bayesian adaptive bias correction using profile
likelihoods</h1>
            <h3 data-toc-skip class="subtitle">Example code using the
<code>EvidenceSynthesis</code> package</h3>
                        <h4 data-toc-skip class="author">Fan Bu</h4>
            
            <h4 data-toc-skip class="date">2023-04-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/EvidenceSynthesis/blob/HEAD/vignettes/BayesianBiasCorrection.Rmd" class="external-link"><code>vignettes/BayesianBiasCorrection.Rmd</code></a></small>
      <div class="hidden name"><code>BayesianBiasCorrection.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We demonstrate Bayesian adaptive bias correction in the context of
vaccine safety surveillance using an example dataset. Safety
surveillance is a post-approval procedure that monitors vaccine products
for adverse events, particularly rare and potentially severe outcomes
that may have been undetected in pre-approval clinical trials. It relies
on sequential analysis of real-world observational healthcare databases.
Therefore, we need to address the challenge of sequential multiple
testing as well as residual and unmeasured confounding in observational
data.</p>
<p>In <code>EvidenceSynthesis</code>, we have implemented methods of
Bayesian adaptive bias correction that can handle sequential analysis
and correct for estimation bias induced by the residual confounding in
observational health data sources. We perform Bayesian bias correction
by jointly modeling the vaccine effect on the adverse event of interest
and learning empirical bias distributions using a Bayesian hierarchical
modeling approach. The empirical bias distribution arises from
simultaneously analyzing a large set of negative control outcomes, which
are known to be not associated with the vaccine of interest. Then, using
Markov chain Monte Carlo (MCMC), we can obtain the posterior
distribution for the de-biased effect size (in terms of the incidence
rate ratio, RR) of the vaccine on the outcome of interest.</p>
<p>To accommodate a federated data network setting where patient-level
information has to be protected but summary-level information is allowed
to be shared, we extract from each data site profile likelihoods
regarding the main effect of interest. For each particular pair of
vaccine exposure and adverse event outcome, and for each epidemiological
design, let <span class="math inline">\(\mathcal{L}(\beta, \gamma;
\mathbf{x})\)</span> denote the likelihood function. Here, <span class="math inline">\(\beta\)</span> is the log RR, the main effect size
of interest; <span class="math inline">\(\gamma\)</span> represents
nuisance parameters; <span class="math inline">\(\mathbf{x}\)</span>
indicates the data. We profile the multivariate likelihood function and
approximate it with a 1d function as follows: <span class="math display">\[
\tilde{\mathcal{L}}(\beta; \mathbf{x})
:=  \max_{\gamma}\mathcal{L}(\beta, \gamma; \mathbf{x}).
\]</span> Then we save the function values evaluated at <span class="math inline">\(\beta\)</span> values on an adaptively chosen
grid. At each analysis time <span class="math inline">\(t\)</span>, for
a specific vaccine exposure and under a particular design, we would
extract a profile likelihood for each negative control outcome and each
outcome of interest.</p>
<p><strong>In this vignette, we will go through two key components of
bias correction</strong>:</p>
<ul>
<li>Learn empirical bias distributions by simultaneously analyzing a
large set of negative control outcomes, adaptively in time.</li>
<li>Perform bias correction to analyze a synthesized outcome of
interest.</li>
</ul>
<p>We provide two example data objects, <code>ncLikelihoods</code> and
<code>ooiLikelihoods</code>, that contain example profile likelihoods
for a large set of negative control outcomes and for a synthetic
outcome, respectively. They are extracted from a real-world
observational healthcare database, and can be loaded by the commands
<code>data("ncLikelihoods")</code> and
<code>data("ooiLikelihoods")</code>. Each profile likelihood takes the
form of a two-column dataframe, where <code>point</code> includes grid
points for <span class="math inline">\(\beta\)</span> and
<code>value</code> includes the corresponding profile likelihood
values.</p>
<p>For example, we can check out the profile likelihood for one of the
negative control outcomes at the 1st analysis period:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/EvidenceSynthesis/" class="external-link">EvidenceSynthesis</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ncLikelihoods"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ooiLikelihoods"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ncLikelihoods</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">point</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-2.30259</td>
<td align="right">-6.90979</td>
</tr>
<tr class="even">
<td align="right">-1.79090</td>
<td align="right">-6.39877</td>
</tr>
<tr class="odd">
<td align="right">-1.27921</td>
<td align="right">-5.88820</td>
</tr>
<tr class="even">
<td align="right">-0.76753</td>
<td align="right">-5.37837</td>
</tr>
<tr class="odd">
<td align="right">-0.25584</td>
<td align="right">-4.86978</td>
</tr>
<tr class="even">
<td align="right">0.25584</td>
<td align="right">-4.36326</td>
</tr>
<tr class="odd">
<td align="right">0.76753</td>
<td align="right">-3.86020</td>
</tr>
<tr class="even">
<td align="right">1.27921</td>
<td align="right">-3.36289</td>
</tr>
<tr class="odd">
<td align="right">1.79090</td>
<td align="right">-2.87519</td>
</tr>
<tr class="even">
<td align="right">2.30259</td>
<td align="right">-2.40352</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="learning-bias-distributions-from-negative-control-outcomes">Learning bias distributions from negative control outcomes<a class="anchor" aria-label="anchor" href="#learning-bias-distributions-from-negative-control-outcomes"></a>
</h2>
<p>At time <span class="math inline">\(t\)</span>, given the profile
likelihoods regarding the negative control outcomes, we can learn an
empirical bias distribution by fitting a hierarchical Bayesian model,
using the <code>computeBayesianMetaAnalysis</code> function.</p>
<p>We assume that the estimation biases associated with the negative
control outcomes are exchangeable and center around an ``average’’ bias
<span class="math inline">\(\bar{b}\)</span> with variability measured
by a scale parameter <span class="math inline">\(\tau\)</span>.</p>
<p>We have implemented a hierarchical normal model and a hierarchical
<span class="math inline">\(t\)</span>-model for the bias distribution,
with the normal model as default, and carry out Bayesian posterior
inference through a random walk Markov chain Monte Carlo (MCMC).</p>
<p>For instance, to learn the bias distribution at the 1st period using
the example dataset, we can call the
<code>fitBiasDistribution</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">singleBiasDist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitBiasDistribution.html">fitBiasDistribution</a></span><span class="op">(</span><span class="va">ncLikelihoods</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The default setting would fit a hierarchical normal model. To fit a
more robust distribution that can better handle heavy tails and
outliers, we can set <code>robust = TRUE</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">singleBiasDistRobust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitBiasDistribution.html">fitBiasDistribution</a></span><span class="op">(</span><span class="va">ncLikelihoods</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  robust <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To learn the bias distribution over multiple analyses, in the setting
of either sequential analysis or group analysis, we can call the
<code>sequentialFitBiasDistribution</code> function. For example, to
adaptively learn all empirical bias distributions across all <span class="math inline">\(12\)</span> analysis periods in the example data,
under the <span class="math inline">\(t\)</span> model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BiasDistRobust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sequentialFitBiasDistribution.html">sequentialFitBiasDistribution</a></span><span class="op">(</span><span class="va">ncLikelihoods</span>,</span>
<span>  robust <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can visualize the learned bias distributions over time using the
<code>plotBiasDistribution</code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBiasDistribution.html">plotBiasDistribution</a></span><span class="op">(</span><span class="va">BiasDistRobust</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="BayesianBiasCorrection_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="perform-bayesian-adaptive-bias-correction">Perform Bayesian adaptive bias correction<a class="anchor" aria-label="anchor" href="#perform-bayesian-adaptive-bias-correction"></a>
</h2>
<p>Now we demonstrate how to perform Bayesian adaptive bias correction
for sequential analysis. At each analysis time <span class="math inline">\(t\)</span>, we use the learned empirical bias
distribution by analyzing negative controls observed up to time <span class="math inline">\(t\)</span> to de-bias our analysis regarding the
outcome of interest. We can do this either for time <span class="math inline">\(t\)</span> only, or for all analysis timepoints
<span class="math inline">\(t = 1, 2, \ldots, T_{\max}\)</span>.</p>
<p>We provide implementation in the function
<code>biasCorrectionInference</code>. To perform bias correction for the
<span class="math inline">\(5\)</span>th analysis, for example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select profile likelihoods for the 5th analysis period</span></span>
<span><span class="va">ooiLik5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ooiLikelihoods</span><span class="op">[[</span><span class="st">"5"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">ncLik5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ncLikelihoods</span><span class="op">[[</span><span class="st">"5"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># specify prior mean and prior standard deviation for the effect size (log RR)</span></span>
<span><span class="va">bbcResult5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/biasCorrectionInference.html">biasCorrectionInference</a></span><span class="op">(</span><span class="va">ooiLik5</span>,</span>
<span>  ncLikelihoodProfiles <span class="op">=</span> <span class="va">ncLik5</span>,</span>
<span>  priorMean <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  priorSd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  doCorrection <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We note that the input should include (1) profile likelihoods on the
outcome of interest on the negative controls (e.g.,
<code>ooiLik5</code>), and (2) profile likelihoods (e.g.,
<code>ncLik5</code>) or the learned bias distributions. The likelihoods
must be provided as a list, where each entry contains the profile
likelihood(s) from one analysis period or group. Therefore, if only one
period or group of data needs to be analyzed, then the profile
likelihoods must be supplied as a list of length <span class="math inline">\(1\)</span>.</p>
<p>If the bias distribution is already available or has been learned
separately, then we can also specify it in the
<code>biasDistributions</code> argument. This can be more convenient and
efficient if there are more than one outcomes of interest to analyze, as
the learned bias distributions can then be re-used. For example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># learn bias distribution for the 5th analysis period first</span></span>
<span><span class="va">biasDist5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitBiasDistribution.html">fitBiasDistribution</a></span><span class="op">(</span><span class="va">ncLikelihoods</span><span class="op">[[</span><span class="st">"5"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># then recycle the bias distribution</span></span>
<span><span class="va">bbcResult5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/biasCorrectionInference.html">biasCorrectionInference</a></span><span class="op">(</span><span class="va">ooiLik5</span>,</span>
<span>  biasDistributions <span class="op">=</span> <span class="va">biasDist5</span>,</span>
<span>  priorMean <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  priorSd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  doCorrection <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The main output is a summary table of the analysis results, including
posterior median and mean (columns <code>median</code> and
<code>mean</code>), the 95% credible interval (columns
<code>ci95Lb</code> and <code>ci95Ub</code>), and the posterior
probability that there is a positive effect (in column <code>p1</code>).
Estimates without bias correction can be accessed in the
<code>summaryRaw</code> attribute, and so we can compare the results
with and without bias correction.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">bbcResult5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>biasCorrection <span class="op">=</span> <span class="st">"yes"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bbcResult5</span>, <span class="st">"summaryRaw"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>biasCorrection <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Id</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">median</th>
<th align="right">mean</th>
<th align="right">ci95Lb</th>
<th align="right">ci95Ub</th>
<th align="right">p1</th>
<th align="left">biasCorrection</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.5935</td>
<td align="right">0.5939</td>
<td align="right">-0.8838</td>
<td align="right">2.0502</td>
<td align="right">0.7949</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="right">1.1588</td>
<td align="right">1.1551</td>
<td align="right">0.9043</td>
<td align="right">1.3981</td>
<td align="right">1.0000</td>
<td align="left">no</td>
</tr>
</tbody>
</table>
<p>To perform sequential analysis with adaptive bias correction over
time, we should supply profile likelihoods across all analysis
periods/groups in the input. For example, if we use the already learned
bias distributions <code>BiasDistRobust</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbcSequential</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/biasCorrectionInference.html">biasCorrectionInference</a></span><span class="op">(</span><span class="va">ooiLikelihoods</span>,</span>
<span>  biasDistributions <span class="op">=</span> <span class="va">BiasDistRobust</span>,</span>
<span>  priorMean <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  priorSd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  doCorrection <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can then check out the sequential analysis results:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">bbcSequential</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>period <span class="op">=</span> <span class="va">Id</span>, <span class="va">median</span><span class="op">:</span><span class="va">p1</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">period</th>
<th align="right">median</th>
<th align="right">mean</th>
<th align="right">ci95Lb</th>
<th align="right">ci95Ub</th>
<th align="right">p1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">0.4875</td>
<td align="right">0.7422</td>
<td align="right">-3.5436</td>
<td align="right">5.8970</td>
<td align="right">0.5856</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">-1.3418</td>
<td align="right">-1.3949</td>
<td align="right">-4.3864</td>
<td align="right">1.5127</td>
<td align="right">0.1428</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">-0.1727</td>
<td align="right">-0.1850</td>
<td align="right">-3.0050</td>
<td align="right">2.7624</td>
<td align="right">0.4346</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">0.3537</td>
<td align="right">0.3656</td>
<td align="right">-2.6551</td>
<td align="right">3.4021</td>
<td align="right">0.6258</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">0.6284</td>
<td align="right">0.6229</td>
<td align="right">-2.4261</td>
<td align="right">3.9465</td>
<td align="right">0.7042</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">0.6528</td>
<td align="right">0.6457</td>
<td align="right">-2.4722</td>
<td align="right">3.9950</td>
<td align="right">0.7099</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="right">0.5284</td>
<td align="right">0.5207</td>
<td align="right">-2.3062</td>
<td align="right">3.4768</td>
<td align="right">0.6894</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="right">0.6556</td>
<td align="right">0.6423</td>
<td align="right">-2.2494</td>
<td align="right">3.4861</td>
<td align="right">0.7305</td>
</tr>
<tr class="odd">
<td align="left">9</td>
<td align="right">0.6126</td>
<td align="right">0.6111</td>
<td align="right">-2.1726</td>
<td align="right">3.5031</td>
<td align="right">0.7179</td>
</tr>
<tr class="even">
<td align="left">10</td>
<td align="right">0.6316</td>
<td align="right">0.6464</td>
<td align="right">-2.1094</td>
<td align="right">3.3503</td>
<td align="right">0.7420</td>
</tr>
<tr class="odd">
<td align="left">11</td>
<td align="right">0.6685</td>
<td align="right">0.6763</td>
<td align="right">-1.8358</td>
<td align="right">3.6872</td>
<td align="right">0.7465</td>
</tr>
<tr class="even">
<td align="left">12</td>
<td align="right">0.5929</td>
<td align="right">0.5964</td>
<td align="right">-1.8419</td>
<td align="right">3.1823</td>
<td align="right">0.7377</td>
</tr>
</tbody>
</table>
<p>The <code>plotBiasCorrectionInference</code> function provides some
simple plotting functionality to visualize the analysis results. For
example, we can visualize the posterior distributions of the bias
corrected log RR across analysis periods, along with posterior
probabilities for a positive effect size (<code>P(H1)</code>) or a
non-positive effect size (<code>P(H0)</code>):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBiasCorrectionInference.html">plotBiasCorrectionInference</a></span><span class="op">(</span><span class="va">bbcSequential</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"corrected"</span>,</span>
<span>  limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="BayesianBiasCorrection_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Meanwhile, we can also compare the estimates with and without bias
correction. It is also possible to only examine certain analysis
periods/groups by specifying the <code>ids</code> argument.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBiasCorrectionInference.html">plotBiasCorrectionInference</a></span><span class="op">(</span><span class="va">bbcSequential</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"compare"</span>,</span>
<span>  limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="BayesianBiasCorrection_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martijn Schuemie, Marc A. Suchard, Fan Bu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
